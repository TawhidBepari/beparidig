<script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
<script>
  // change this to your actual client token (sandbox or live)
  Paddle.Environment.set('sandbox');
  const PADDLE_CLIENT_TOKEN = "test_b258e068a5cc3ad7ce0ad32e93b";

  // the URL for your thank-you page (must match the actual file on your site)
  const SUCCESS_URL = "https://beparidig.netlify.app/thank-you.html";

  // Initialize Paddle and add an event callback to force redirect on checkout completion
  Paddle.Initialize({
    token: PADDLE_CLIENT_TOKEN,
    eventCallback: function(ev) {
      try {
        // Paddle emits events with a `name` property e.g. "checkout.completed"
        if (ev && ev.name === "checkout.completed") {
          console.log("Paddle event checkout.completed:", ev);

          // try a few places to get a checkout/txn id (Paddle shape varies)
          const ptxn =
            ev?.data?.checkout?.id ||
            ev?.data?.id ||
            ev?.checkout?.id ||
            ev?.data?.transaction_id ||
            ev?.transaction?.id ||
            "";

          // build redirect URL; append _ptxn if we found it (helps token lookup)
          let url = SUCCESS_URL;
          if (ptxn) {
            url += (url.includes('?') ? '&' : '?') + '_ptxn=' + encodeURIComponent(ptxn);
          }

          // force redirect (fallback in case successUrl didn't)
          window.location.href = url;
        }
      } catch (e) {
        console.error("eventCallback error:", e);
        // still attempt the fallback redirect
        // (do not append _ptxn if something errored)
        // window.location.href = SUCCESS_URL;
      }
    }
  });

  // attach to your button
  document.getElementById('buy-now-index').addEventListener('click', function() {
    Paddle.Checkout.open({
      items: [{ priceId: "pri_01k5b696s0bvmk13jgtdzc3q3q", quantity: 1 }],
      successUrl: SUCCESS_URL
      // you can add other settings here if needed
    });
  });
</script>
